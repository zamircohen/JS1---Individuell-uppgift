<!DOCTYPE html>

<html>

    <head>
        <title>Individuella uppgiften - Store front</title>

        <style>
            .header {
                overflow: hidden;
                /* background-color: rgb(116, 0, 184, 249, 250); */
                background-color: rgb(255,255,255);             
                position: sticky; /* Set the navbar to fixed position */
                top: 0; /* Position the navbar at the top of the page */
                width: 100%; /* Full width */
            }    

        </style>



    </head>

    <body>

    <div class="header">

        <div id="filter">
            <label for="rating">Filter on rating (0-5)</label>
            <input id="rating" type="text" value="" min="1" max="5"/>
            <br>
            <br>
            <label for="priceRange">Filter on price</label>
            <input id="minPrice" type="text" value="0" min="0"/>
            <input id="maxPrice" type="text" value="999999" min="0"/>

            <button onclick="handleOnClick()" id="filterButton">Filter</button>
            <p id="errorMessage"></p>

        </div>

        <h2>Shopping cart</h2>
        <p id="total"></p>


        <div id="shopping">            
            
        </div>

        <hr>

    </div>

        <div id="products">
        </div>


        <script>

            const url = "https://mock-data-api.firebaseio.com/webb21/products.json"

            let total = 0
            let rateInput = 0
            let minPriceInput = 0
            let maxPriceInput = 999999
            const totalMessage = document.getElementById("total")
            totalMessage.innerText = "Total: 0kr" 

            const productContainer = document.getElementById("products")
            const shoppingContainer = document.getElementById("shopping")

            const filterButton = document.getElementById("filterButton")
            const userRating = document.getElementById("rating")


            function handleOnClick(){
                const userInput = document.getElementById("rating")
                const rating = userInput.value
                
                const userInputminPrice = document.getElementById("minPrice")
                const userInputmaxPrice = document.getElementById("maxPrice")

                const userMinPrice = userInputminPrice.value
                const userMaxPrice = userInputmaxPrice.value

                const errorMessage = document.getElementById("errorMessage")

                if(rating < 0 || rating > 5 || userMinPrice < 0 || userMaxPrice < 0){
                    errorMessage.innerText = "Please insert valid values"
                }else 
                
                errorMessage.innerText = ""
                document.getElementById("products").innerHTML = ""                 // Clears the productlist
                getMessageList(rating, userMinPrice, userMaxPrice)
            }




                function renderArticleItem(item, rating, minPrice, maxPrice) {

                    const productName = document.createElement("h3")
                    productName.innerText = item.name

                    const productDescription = document.createElement("p")
                    productDescription.innerText = item.description

                    const productPrice = document.createElement("p")
                    productPrice.innerText = `Price: ${item.price}kr`

                    const productRating = document.createElement("i")
                    productRating.innerText = `Rating: ${item.rating}/5`

                    const productStock = document.createElement("p")
                    productStock.innerText = `In stock: ${item.stock}`

                    const buyButton = document.createElement("button")
                    buyButton.innerText = `Buy`

                    buyButton.addEventListener("click", function() {
                        
                        total += item.price
                        totalMessage.innerText = `Total: ${total}kr`

                        const shoppingList = document.createElement("p")
                        shoppingList.innerText = `${item.name} - ${item.price}kr`
                        
                        shoppingContainer.appendChild(shoppingList)
                    })


                    const line = document.createElement("hr")

                    const image = document.createElement("img")
                    image.src = item["images"]["0"]["src"]["small"]
                    image.alt = item["images"]["0"]["alt"]
                    image.width = "300"

                    // Adds product in total and list on a click
                    // image.addEventListener("click", function() {                        
                    //     total += item.price
                    //     totalMessage.innerText = `Total: ${total}kr`
                    //     const shoppingList = document.createElement("p")
                    //     shoppingList.innerText = `${item.name}kr - ${item.price}kr`
                    //     shoppingContainer.appendChild(shoppingList)
                    // })



                    if(item.rating >= rating && item.price >= minPrice && item.price <= maxPrice){
                    productContainer.appendChild(productName)
                    productContainer.appendChild(image)
                    productContainer.appendChild(productDescription)
                    productContainer.appendChild(productPrice)
                    productContainer.appendChild(productRating)
                    productContainer.appendChild(productStock)
                    productContainer.appendChild(buyButton)
                    productContainer.appendChild(line)   
                    }
                    

                }



            function renderArticleList(articleList, rating, minPrice, maxPrice) {
                articleList.forEach(articleItem => {
                    renderArticleItem(articleItem, rating, minPrice, maxPrice)
                })
            }            


            function getMessageList(rating, minPrice, maxPrice) {
            fetch(url)
            .then(response => response.json())
            .then(data => {
                renderArticleList(data, rating, minPrice, maxPrice)
            })    
        }


       getMessageList(rateInput, minPriceInput, maxPriceInput)


        </script>

    </body>

</html>